<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><!-- InstanceBegin template="/Templates/sdkDoc.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../style_sdk.css" rel="stylesheet" type="text/css"/>
<!-- InstanceBeginEditable name="doctitle" -->
<title>ASP Server Scripts</title>
<!-- InstanceEndEditable --><!-- InstanceBeginEditable name="head" -->
<meta name="Author" content="Phil Burk">
<meta name="KeyWords" content="record, voice, Applet, upload, server, scripts, PHP, ASP, JSP">
<!-- InstanceEndEditable -->
</head>
<body>
<center>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr valign="middle">
      <td width="200" bgcolor="#DCE2E7"><center>
          <font color="#FF9933" size="+2"><strong><em><a href="http://www.javasonics.com/" target="_top"> <font face="Verdana, Arial, Helvetica, sans-serif">JavaSonics</font></a></em> </strong></font>
        </center></td>
      <td width="60" bgcolor="#DCE2E7"><center>
          <h1>SDK</h1>
        </center></td>
      <td bgcolor="#DCE2E7"><center>
          <h1><!-- InstanceBeginEditable name="mainHeading" -->Documentation<!-- InstanceEndEditable --></h1>
        </center></td>
    </tr>
  </table>
</center>
<table width="100%" border="0" cellpadding="0" cellspacing="0" >
  <tr>
    <td valign="top" width="100" bgcolor="#D7E5F2"><br>
      <p><a class="sidenavbar" href="http://www.javasonics.com/" target="_top">Web&nbsp;Home</a></p>
      <p><a class="sidenavbar" href="../index.html" target="_top">SDK&nbsp;Home</a></p>
      <p><a class="sidenavbar" href="index.html" target="_top">Docs</a></p>
      <p><a class="sidenavbar" href="../php_test/index.html" target="_top">Test&nbsp;PHP</a></p>
      <p><a class="sidenavbar" href="../asp_test/index.html" target="_top">Test&nbsp;ASP</a></p>
      <p><a class="sidenavbar" href="../asp_net_test/index.html" target="_top">Test&nbsp;ASP.NET</a></p>
      <p><a class="sidenavbar" href="../examples/index.html" target="_top">Examples</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/demos/" target="_top">Demos</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/downloads/" target="_top">Download</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/sales/" target="_top">Purchase</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/support/" target="_top">Support</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/forum/" target="_top">Forum</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/login/" target="_top">Login</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/contacts.php" target="_top">Contact&nbsp;Us</a></p>
      <p><a class="sidenavbar" href="http://www.mobileer.com/" target="_blank">Company</a></p>
      <br>
    </td>
    <td valign="top"><div class="primary"> <!-- InstanceBeginEditable name="primaryContent" -->
        <h2> Writing Server Scripts with ASP.NET</h2>
        <h3>Use Plain Text</h3>
        <p>The first thing you must do in your ASP script is to set the content type to plain text. This simplifies the text that is sent back to ListenUp, making it easier to parse. <strong>These header values must be set before you send any other text!</strong> Here is some ASP code that may work for you:</p>
        <blockquote>
          <pre>response.ContentType = "text/plain"
response.Charset = "ISO-8859-1"
</pre>
        </blockquote>
        <p>If you need to set response content prior to setting the ContentType
          as above, you should buffer your response before sending it. To do
          this, set
          the BufferOutput property to true so the entire page will be processed
          before any content is returned to the client:</p>
        <pre>     response.Clear();
     response.BufferOutput = true;</pre>
        <p>When you're done, call Flush() to send the completed response to the
          client:</p>
        <pre>     response.Flush();</pre>
        <h3>Receiving Uploaded Files</h3>
        <p>The <strong>Files</strong> collection in the <strong>Request</strong> object is a collection of <strong>HttpPostedFiles</strong>. The
          .Net Framework includes the class <strong>HttpPostedFile</strong> in the System.Web
          namespace. A <strong>HttpPostedFile</strong> object encapsulates a file that has been
          included with a multipart/file POST request, such as that issued by
          the ListenUp client. </p>
        <blockquote>
          <pre>System.Web.HttpPostedFile file = Request.Files[&quot;userfile&quot;];
</pre>
        </blockquote>
        <h3>Getting Variable Data (Name/Value pairs) </h3>
        <p>The ASP.NET <strong>Request</strong> object has a property, <strong>.Form</strong>,
          that is a collection of POST name/value pairs accompanying the request.
          You can use this to discover information sent along with the uploaded
          file. For example, to get the duration of the uploaded file in seconds: </p>
        <blockquote>
          <pre>duration = Convert.ToDouble( Request.Form[&quot;duration&quot;] );</pre>
        </blockquote>
        <h3>Getting Information about the Uploaded File </h3>
        <p>After you've got your file in an <strong>HttpPostedFile</strong> object, you can retrieve
          specific information about the uploaded file by looking at the properties
          of the  object.
          For example, to view the size and suggested name of a file called &quot;userfile&quot;,
          you can use the following:</p>
        <blockquote>
          <pre>upfile_size = file.ContentLength;
raw_name = file.FileName;  // contains fully-qualified path
fileInfo = new FileInfo( raw_name );
upfile_name = fileInfo.Name;  // extract just the name from the path</pre>
        </blockquote>
        <h3>Validation</h3>
        <p>It is possible that someone could create another program that pretended
          to be ListenUp and send you some bogus files. So you should check to
          make sure that no-one is uploading a file that is too big. </p>
<blockquote>
<pre>
if( upfile_size &gt; upfile_size_limit)
{
  Response.Write( String.Format(&quot;ERROR - script says file too large, {0} &gt; {1}\n&quot;, upfile_size, upfile_size_limit) );
  err = true;
}
</pre>
</blockquote>
        <h3>Save file to destination</h3>
        <p>Save the file to its final destination. IIS must have permission to
          write into that folder.</p>
        <blockquote>
          <pre>String upload_dir = &quot;../uploads&quot;;
file.SaveAs( Server.MapPath(uploads_dir + &quot;\\&quot; + upfile_name)  );</pre>
        </blockquote>
        <h4>Problems</h4>
        <h5>Large Files</h5>
        <p><strong>HttpPostedFiles</strong> are buffered to disk temporarily
          if they exceed a size that can comfortably be held in memory by the
          server. By default, ASP.NET limits <strong>Request</strong> objects
          to 4Mb total size. If this isn't large enough for the files you're
          working with, you can override the limit for the server using machine.config,
          for that particular application using web.config, or even for the page.
          See the .Net documentation for the <strong>HttpPostedFile</strong> class
          for details. </p>
        <h5>Permissions</h5>
        <p>It's quite common to run into a conflict between Windows and IIS permissions.
          If your application is set up to require authentication, the authentication
          method will determine the user account that is used to write an uploaded
          file: it may be the IIS_USER account, or the Windows account of the
          logged-in user. If the destination directory is not set up with the
          requisite access control, your call to <strong>.SaveAs</strong> or <strong>.Move</strong> may
          fail.</p>
        <p>Debugging this kind of problem can be somewhat painful. Start by setting
          authentication requirements for your ListenUp app to Anonymous (no
          authentication required), make sure the uploads directory has Read
          and Write permission for Everyone, and that IIS has Read and Write
          access to that directory. See <a href="http://www.15seconds.com/Issue/020123.htm">http://www.15seconds.com/Issue/020123.htm</a> for
          a decent overview of troubleshooting this kind of problem. </p>
        <h3>Return Status Codes</h3>
        <p>Your script must return a status code of SUCCESS, WARNING or ERROR
          at the beginning of a line. For example:</p>
        <pre>     Response.Write( String.Format(&quot;SUCCESS - {0} uploaded.\n&quot;, upfile_name) );</pre>
        <p>&nbsp;</p>
        [<a href="index.html">Top</a>] [<a href="server_scripts.html">Previous</a>][<a href="naming_files.html">Next</a><a href="custom_parameters.html"></a>]<!-- InstanceEndEditable --> </div></td>
  </tr>
</table>
<br>
<div align="left"> &copy; 2001-2006 <a href="http://www.mobileer.com/">Mobileer, Inc.</a> &nbsp;&nbsp;This page is from the ListenUp&nbsp;SDK. You can download the SDK from <a href="http://www.javasonics.com/downloads/">here</a>.</div>
</body>
<!-- InstanceEnd --></html>
