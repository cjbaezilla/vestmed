<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><!-- InstanceBegin template="/Templates/sdkDoc.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../style_sdk.css" rel="stylesheet" type="text/css"/>
<!-- InstanceBeginEditable name="doctitle" -->
<title>PHP Server Scripts</title>
<!-- InstanceEndEditable --><!-- InstanceBeginEditable name="head" -->
<meta name="Author" content="Phil Burk">
<meta name="KeyWords" content="record, voice, Applet, upload, server, scripts, PHP, ASP, JSP">
<style type="text/css">
<!--
.style1 {font-family: "Courier New", Courier, mono}
-->
</style>
<!-- InstanceEndEditable -->
</head>
<body>
<center>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr valign="middle">
      <td width="200" bgcolor="#DCE2E7"><center>
          <font color="#FF9933" size="+2"><strong><em><a href="http://www.javasonics.com/" target="_top"> <font face="Verdana, Arial, Helvetica, sans-serif">JavaSonics</font></a></em> </strong></font>
        </center></td>
      <td width="60" bgcolor="#DCE2E7"><center>
          <h1>SDK</h1>
        </center></td>
      <td bgcolor="#DCE2E7"><center>
          <h1><!-- InstanceBeginEditable name="mainHeading" -->Documentation<!-- InstanceEndEditable --></h1>
        </center></td>
    </tr>
  </table>
</center>
<table width="100%" border="0" cellpadding="0" cellspacing="0" >
  <tr>
    <td valign="top" width="100" bgcolor="#D7E5F2"><br>
      <p><a class="sidenavbar" href="http://www.javasonics.com/" target="_top">Web&nbsp;Home</a></p>
      <p><a class="sidenavbar" href="../index.html" target="_top">SDK&nbsp;Home</a></p>
      <p><a class="sidenavbar" href="index.html" target="_top">Docs</a></p>
      <p><a class="sidenavbar" href="../php_test/index.html" target="_top">Test&nbsp;PHP</a></p>
      <p><a class="sidenavbar" href="../asp_test/index.html" target="_top">Test&nbsp;ASP</a></p>
      <p><a class="sidenavbar" href="../asp_net_test/index.html" target="_top">Test&nbsp;ASP.NET</a></p>
      <p><a class="sidenavbar" href="../examples/index.html" target="_top">Examples</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/demos/" target="_top">Demos</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/downloads/" target="_top">Download</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/sales/" target="_top">Purchase</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/support/" target="_top">Support</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/forum/" target="_top">Forum</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/login/" target="_top">Login</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/contacts.php" target="_top">Contact&nbsp;Us</a></p>
      <p><a class="sidenavbar" href="http://www.mobileer.com/" target="_blank">Company</a></p>
      <br>
    </td>
    <td valign="top"><div class="primary"> <!-- InstanceBeginEditable name="primaryContent" -->
                <h2> Writing Server Scripts in PHP</h2>
                <p> PHP has a simple utility for receiving uploaded files. Documentation is here: <a href="http://www.php.net/manual/en/features.file-upload.php">http://www.php.net/manual/en/features.file-upload.php</a>.</p>
                <p>For a complete PHP example used with ListenUp, please see the file "<strong>php_test/handle_upload_simple.php</strong>". Note that this file checks for specific file names that we use in our tests. You should <strong>modify or remove these checks</strong> to match your application's file names. </p>
                <h3>Use Plain Text</h3>
                <p>The first thing you must do in your PHP script is to set the content type to plain text. This simplifies the text that is sent back to ListenUp, making it easier to parse. <strong>These header values must be set before you send any other text!</strong></p>
                <pre>&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Cache-control: private&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;header(&quot;Content-Type: text/plain&quot;);
				</pre>
                <h3>Getting Variable Data (Name/Value pairs) </h3>
                <p>We use the $_POST global to access the posted variables. This technique will work regardless of the value of the <a href="http://www.php.net/manual/en/configuration.directives.php#ini.register-globals" target="_blank">register_globals</a> variable and is thus very portable. We use strip_tags() to prevent pirates from hacking your server scripts. For example, to get the duration of the uploaded file in seconds: </p>
                <blockquote>
                    <pre>$duration = strip_tags($_POST['duration']);</pre>
                </blockquote>
                <h3>Getting the Uploaded File</h3>
                <p>PHP stores POSTed files in a temporary area, then fills in the array $_FILES with the information you need. Here is how to get the file information. Note we use the name 'userfile' because that is what ListenUp called the file. </p>
                <blockquote>
                    <pre>
// Get size of uploaded file.
$upfile_size = $_FILES[<strong>'userfile'</strong>]['size'];
// Get suggested name of file.
$upfile_name = $_FILES[<strong>'userfile'</strong>]['name'];
</pre>
                </blockquote>
        <h3>Validation</h3>
                <p>It is possible that someone could create another program that pretended to be ListenUp and send you some bogus files. So you should check to make sure that noone is uploading a file that is too big. </p>
                <blockquote>
                    <pre>if( $upfile_size &gt; $upfile_size_limit)
{
    echo &quot;ERROR - file too large, $upfile_size &gt; $upfile_size_limit\n&quot;;
}</pre>
                </blockquote>
                <p>Also make sure that noone is sending a tricky file name by stripping off path information. </p>
                <blockquote>
                    <pre>$upfile_name_safe = basename($upfile_name);  
                    </pre>
                </blockquote>
                <h3>Copy File to Destination</h3>
                <p>Copy file from temporary PHP area  to its final location. PHP must have permission to write to that area. </p>
                <blockquote>
                    <pre>$uploads_dir = &quot;../../uploads/&quot;;
move_uploaded_file($_FILES['userfile']['tmp_name'],
	$uploads_dir . $upfile_name_safe );</pre>
                </blockquote>
        <h4>Problems with Large Files</h4>
                <p>You may have problems uploading large files. Here are some things to consider:</p>
                <ol>
                    <li>If you based your PHP code on our example then you may have inherited our safety limit. Look for a variable like &quot;upfile_size_limit&quot; in the PHP script and increase the limit.</li>
                    <li>Your PHP may be configured with a low limit on the size of an HTTP PHP request. Take a look in your &quot;/etc/httpd/conf.d/php.conf&quot; file. The variable LimitRequestSize can be bumped up if needed. Don't forget to restart Apache if needed. Look for a comment posted 

  04-Dec-2002 on <a href="http://www.php.net/manual/en/features.file-upload.php" target="_blank">this page</a> for more on this topic. </li>
                    <li>There are a few configuration variables that affect uploaded file sizes. They are set in the &quot;php.ini&quot; file. Their values can be printed in your PHP script.<br>
                        <br>
                        <span class="style1">echo &quot;post_max_size = &quot; . ini_get(&quot;post_max_size&quot;) . &quot;\n&quot;;<br>
                        echo &quot;upload_max_filesize = &quot; . ini_get(&quot;upload_max_filesize&quot;) . &quot;\n&quot;;<br>
                        echo &quot;max_input_time = &quot; . ini_get(&quot;max_input_time&quot;) . &quot;\n&quot;;</span>                        <br>
                    </li>
                </ol>
                <h3>Return Status Codes</h3>

                <p>Your script must return a status code of SUCCESS, WARNING or ERROR at the beginning of a line. For example:</p>
                <pre>     echo &quot;SUCCESS - file uploaded.\n&quot;; </pre>
  <p>[<a href="index.html">Top</a>] [<a href="server_scripts.html">Previous</a>] [<a href="naming_files.html">Next</a><a href="custom_parameters.html"></a>] <br>
                </p>
    <!-- InstanceEndEditable --> </div></td>
  </tr>
</table>
<br>
<div align="left"> &copy; 2001-2006 <a href="http://www.mobileer.com/">Mobileer, Inc.</a> &nbsp;&nbsp;This page is from the ListenUp&nbsp;SDK. You can download the SDK from <a href="http://www.javasonics.com/downloads/">here</a>.</div>
</body>
<!-- InstanceEnd --></html>
