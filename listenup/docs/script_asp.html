<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><!-- InstanceBegin template="/Templates/sdkDoc.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../style_sdk.css" rel="stylesheet" type="text/css"/>
<!-- InstanceBeginEditable name="doctitle" -->
<title>ASP Server Scripts</title>
<!-- InstanceEndEditable --><!-- InstanceBeginEditable name="head" -->
   
   <meta name="Author" content="Phil Burk">
   <meta name="KeyWords" content="record, voice, Applet, upload, server, scripts, PHP, ASP, JSP">
<!-- InstanceEndEditable -->
</head>
<body>
<center>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr valign="middle">
      <td width="200" bgcolor="#DCE2E7"><center>
          <font color="#FF9933" size="+2"><strong><em><a href="http://www.javasonics.com/" target="_top"> <font face="Verdana, Arial, Helvetica, sans-serif">JavaSonics</font></a></em> </strong></font>
        </center></td>
      <td width="60" bgcolor="#DCE2E7"><center>
          <h1>SDK</h1>
        </center></td>
      <td bgcolor="#DCE2E7"><center>
          <h1><!-- InstanceBeginEditable name="mainHeading" -->Documentation<!-- InstanceEndEditable --></h1>
        </center></td>
    </tr>
  </table>
</center>
<table width="100%" border="0" cellpadding="0" cellspacing="0" >
  <tr>
    <td valign="top" width="100" bgcolor="#D7E5F2"><br>
      <p><a class="sidenavbar" href="http://www.javasonics.com/" target="_top">Web&nbsp;Home</a></p>
      <p><a class="sidenavbar" href="../index.html" target="_top">SDK&nbsp;Home</a></p>
      <p><a class="sidenavbar" href="index.html" target="_top">Docs</a></p>
      <p><a class="sidenavbar" href="../php_test/index.html" target="_top">Test&nbsp;PHP</a></p>
      <p><a class="sidenavbar" href="../asp_test/index.html" target="_top">Test&nbsp;ASP</a></p>
      <p><a class="sidenavbar" href="../asp_net_test/index.html" target="_top">Test&nbsp;ASP.NET</a></p>
      <p><a class="sidenavbar" href="../examples/index.html" target="_top">Examples</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/demos/" target="_top">Demos</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/downloads/" target="_top">Download</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/sales/" target="_top">Purchase</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/support/" target="_top">Support</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/forum/" target="_top">Forum</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/login/" target="_top">Login</a></p>
      <p><a class="sidenavbar" href="http://www.javasonics.com/contacts.php" target="_top">Contact&nbsp;Us</a></p>
      <p><a class="sidenavbar" href="http://www.mobileer.com/" target="_blank">Company</a></p>
      <br>
    </td>
    <td valign="top"><div class="primary"> <!-- InstanceBeginEditable name="primaryContent" -->

<h2>
Writing Server Scripts with ASP</h2>
<p>ASP &quot;classic&quot; has no simple utility for receiving uploaded files. Most developers
  choose to use a 3rd-party component for this function. Most IIS web hosts provide
  some such component for server-side application use as part of their hosting
      package. One of the most common and well-supported such components is <strong>ASPUpload</strong> from
      Persits Software (<a href="http://www.aspupload.com/" target="_blank">http://www.aspupload.com/</a>); we'll use that for our examples. Note that ASPUpload is a commercial product. You can find some free alternatives <a href="http://www.aspin.com/home/webapps/fileoper/upload" target="_blank">here</a>.</p>
<p>For a complete example used with ListenUp, please see the file &quot;<strong>asp_test/handle_upload_simple.asp</strong>&quot;.
  Note that this file checks for specific file names that we use in our tests.
  You should <strong>modify or remove these checks</strong> to match your application's
  file names.</p>
<h3>Use Plain Text</h3>
<p>The first thing you must do in your ASP script is to set the content type
  to plain text. This simplifies the text that is sent back to ListenUp, making
  it easier to parse. <strong>These header values must be set before you send
  any other text!</strong></p>
<blockquote>
    <pre>response.ContentType = "text/plain"</pre>
</blockquote>
<h3>Instantiate the Upload object</h3>
<p>You need to create the object that will handle the file upload. Using <strong>ASPUpload</strong>,
  for example: </p>
<blockquote>
  <pre>Set upload = Server.CreateObject(&quot;Persits.Upload&quot;)</pre>
</blockquote>
<h3>Getting Variable Data (Name/Value pairs) </h3>
<p>The ASP <strong>Request</strong> object has a property, <strong>.Form</strong>,
  that is a collection of POST name/value pairs accompanying the request. You
  can use this to discover information sent along with the uploaded file. For
  example, to get the duration of the uploaded file in seconds: </p>
<blockquote>
  <pre>duration = strip_tags(Request.Form(&quot;duration&quot;))</pre>
</blockquote>
<p><strong>strip_tags()</strong> is a function we've defined to use regular
  expressions to strip HTML from a string. You might use it as above to remove
  malicious or malformed parameters passed in with the form. </p>
<p>ASPUpload has
    a property, <strong>UploadManager.Form</strong>,
    that does the same thing after you've called the <strong>Save</strong> method
    to parse and store the file.
    Using this property, the above example would be:</p>
<blockquote>
  <pre>
upload.Save  ' saves the file in memory
duration = strip_tags(upload.Form(&quot;duration&quot;))</pre>
</blockquote>
<h3>Getting Information about the Uploaded File </h3>
<p>After you've called the <strong>Save</strong> method, you can retrieve specific
  information about the uploaded file by looking at the properties of the <strong>UploadedFile</strong> object
  in the <strong>UploadManager.Files</strong> collection. For example, to view
  the size and suggested name of a file called &quot;userfile&quot;, you can use the following:</p>
<blockquote>
  <pre>Set file = upload.Files(&quot;userfile&quot;)
upfile_size = strip_tags(file.Size)
upfile_name = strip_tags(file.OriginalFileName)</pre>
</blockquote>
<h3>Validation</h3>
<p>It is possible that someone could create another program that pretended to
  be ListenUp and send you some bogus files. So you should check to make sure
  that noone is uploading a file that is too big. </p>
<blockquote>
  <pre>if upfile_size &gt; upfile_size_limit then
    Response.Write &quot;ERROR - file too large, &quot; &amp; upfile_size &amp; &quot; &gt; &quot; &amp; upfile_size_limit &amp; vbLF
end if</pre>
</blockquote>
<p>The <strong>UploadFile</strong> object has properties for the original name
  (no path), the original folder (just the parent path) and the original path
  (the whole enchilada). You're going to want to use <strong>.OriginalFileName</strong> to
  avoid users sending something unwanted in the path. </p>
<blockquote>
  <pre>upfile_name_safe = strip_tags(file.OriginalFileName)</pre>
</blockquote>
<h3>Save file to destination</h3>
<p>Save the file to its final destination. IIS must have permission to write
  into that folder.</p>
<blockquote>
  <pre>upload_dir = &quot;../uploads&quot;
file.SaveAs Server.MapPath(upload_dir) & "\" & upfile_name_safe</pre>
</blockquote>
<h4>Problems</h4>
<h5>Large Files</h5>
<p>The technique shown above saves the uploaded file first to memory. If the
  file is large, this may fail. In this event, you'll want to save the file to
  a temporary spot on your server disk, then use <strong>UploadFile.SaveAs</strong> or
  <strong>UploadFile.Move</strong> to move it to the final destination. </p>
<h5>Permissions</h5>
<p>It's quite common to run into a conflict between Windows and IIS permissions.
  If your application is set up to require authentication, the authentication
  method will determine the user account that is used to write an uploaded file:
  it may be the IIS_USER account, or the Windows account of the logged-in user.
  If the destination directory is not set up with the requisite access control,
  your call to <strong>.SaveAs</strong> or <strong>.Move</strong> may fail.</p>
<p>Debugging this kind of problem can be somewhat painful. Start by setting authentication
  requirements for your ListenUp app to Anonymous (no authentication required),
  make sure the uploads directory has Read and Write permission for Everyone,
  and that IIS has Read and Write access to that directory. See <a href="http://www.15seconds.com/Issue/020123.htm">http://www.15seconds.com/Issue/020123.htm</a>  for a decent overview of troubleshooting this kind of problem. </p>
<h3>Return Status Codes</h3>
<p>Your script must return a status code of SUCCESS, WARNING or ERROR at the
  beginning of a line. For example:</p>
<pre>     Response.Write &quot;SUCCESS - file uploaded.&quot; &amp; vbLF</pre>
<h3>Clean up</h3>
<p>Make sure you remove any references to objects you've created. For example,
  to remove references to ASPUpload objects:</p>
<blockquote>
<pre>Set file = Nothing
Set upload = Nothing
</pre>
</blockquote>
<p>
[<a href="index.html">Top</a>] [<a href="server_scripts.html">Previous</a>][<a href="naming_files.html">Next</a><a href="custom_parameters.html"></a>]</p>
    <!-- InstanceEndEditable --> </div></td>
  </tr>
</table>
<br>
<div align="left"> &copy; 2001-2006 <a href="http://www.mobileer.com/">Mobileer, Inc.</a> &nbsp;&nbsp;This page is from the ListenUp&nbsp;SDK. You can download the SDK from <a href="http://www.javasonics.com/downloads/">here</a>.</div>
</body>
<!-- InstanceEnd --></html>
